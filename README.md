# API для выставки котят

Данный API управляет породами котят, самими котятами и позволяет пользователям ставить оценки котятам. API поддерживает аутентификацию пользователей, операции CRUD для котят, и предоставляет возможность фильтрации по породам.

## Возможности

- **Аутентификация**: Используется JWT для безопасной аутентификации.
- **Управление котятами**: CRUD операции для котят с ограничением прав доступа.
- **Управление породами**: Доступ к породам открыт для всех пользователей.
- **Фильтрация**: Возможность фильтрации котят по породам.
- **Оценки**: Пользователи могут оценивать котят.

## Технологии

- **Backend**: Django, Django REST Framework (DRF)
- **База данных**: PostgreSQL или SQLite (в зависимости от конфигурации, сейчас в settings.py стоят настройки для Docker, в котором запускается PostgreSQL)
- **Аутентификация**: JWT (JSON Web Tokens)
- **Docker**: Использование Docker и docker-compose для быстрого развёртывания.

## Запуск проекта

### Локальный запуск
 #### Если хотите запустить в контрейнере Docker, то пропустите раздел локального запуска
1. Убедитесь, что у вас установлены следующие зависимости:
   - Python 3.8+
   - PostgreSQL (либо SQLite, если хотите использовать его, то для использования необходимо будет поменять настройки, информация ниже)
   - Docker (для контейнеризации)

2. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/Thorch3n/kitten_show.git
   ```
3. Переходим в корень проекта:
    ```bash
    cd kitten_exhibition
    ```
4. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```
5. Изменить настройки для локального запуска:

    Для запуска локально замените настройки БД в settings.py, сейчас там стоит:
    ```
       DATABASES = {
        'default': dj_database_url.config(
            default=os.getenv('DATABASE_URL')
        )
       }
    ```
    Замените выше указанный код на следующее:
    ```
       DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.sqlite3',
            'NAME': BASE_DIR / 'db.sqlite3',
        }
    }
   ```
6. Запустить сервер разработки:

    Так как мы используем локальную базу данных, которая была скопирована с репозитория, то соответственно у нас нет 
необходимости делать миграции и соответственно сразу запускаем сервер
    ```bash
    python manage.py runserver
    ```

### Запуск Docker

1. Убедитесь, что в файле settings.py настройки БД такие же как указаны ниже:
    ```
       DATABASES = {
       'default': dj_database_url.config(
           default=os.getenv('DATABASE_URL')
       )
   }
    ```
2. Запустите контейнеры с помощью Docker:
   ```
    docker-compose up --build
   ```
## API Документация
Все запросы к API можно сделать по адресу /api/docs, там же и аутентификация
### Аутентификация

Для работы с большинством эндпоинтов требуется аутентификация с использованием JWT. Чтобы получить токен, отправьте POST-запрос на /api/token/ с данными пользователя (логин и пароль).

### Пользователи:

Ниже приведены пользователи, которые имеются в БД SQLite и загружаются в PostgreSQL в Docker через фикстуры

```
login: admin
password: 123123
role: superuser
```
```
login: usver
password: 1Z2x3c4c
role: user
```
```
login: neadmin
password: 1Z2x3c4c
role: user
```

### Пример запроса для получения токена:
```
{
POST /api/token/
    "username": "user1",
    "password": "password123"
}
```
### Пример ответа:
```
{
    "access": "jwt_access_token",
    "refresh": "jwt_refresh_token"
}
```
## Эндпоинты
### Породы котят
- Получить список всех пород: ```GET /api/breeds/```
- Получить породу по ID: ```GET /api/breeds/{id}/```
- Создать новую породу (для администраторов): ```POST /api/breeds/```
- Обновить породу (для администраторов): ```PUT /api/breeds/{id}/```
- Удалить породу (для администраторов): ```DELETE /api/breeds/{id}/```
### Котята
- Получить список всех котят: ```GET /api/kittens/```
- Получить котенка по ID: GET ```/api/kittens/{id}/```
- Создать нового котенка (только аутентифицированные пользователи): ```POST /api/kittens/```
- Обновить информацию о котенке (только автор или администратор): ```PUT /api/kittens/{id}/```
- Удалить котенка (только автор или администратор): ```DELETE /api/kittens/{id}/```
### Фильтрация котят по породе
- Получить котят по ID породы: ```GET /api/kittens/by_breed/?breed_id={breed_id}```
### Оценка котят
- Оценить котенка: ```POST /api/kittens/{id}/rate_kitten/```
    - Параметр: ```rating``` (оценка от 1 до 5)
### Пример запроса на оценку:
```
POST /api/kittens/1/rate_kitten/
{
    "rating": 5
}
```
## Тестирование
    
Тесты проекта написаны с использованием pytest. 
Перед запуском тестов убедитесь, что в settings.py стоят настройки на БД SQLite:
```bash
DATABASES = {
        'default': {
            'ENGINE': 'django.db.backends.sqlite3',
            'NAME': BASE_DIR / 'db.sqlite3',
        }
    }
```
Для запуска тестов используйте команду:
```bash
pytest
```

## Автор
Проект создан Тороповым Никитой (Thorch3n) в рамках технического задания.

